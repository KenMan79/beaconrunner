<!DOCTYPE html>
<html>
<head><meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>altair_incentives</title>
  
  
  
  
  <meta property="og:title" content="altair_incentives" />
  <meta property="og:url" content="https://ethereum.github.io//" />
  <meta property="og:image" content="https://ethereum.github.io/rig/static/rig.png" />
  <meta property="og:description" content="" />

  <script src="https://cdn.jsdelivr.net/npm/underscore@1.13.1/underscore-umd-min.js" type="text/javascript"></script>
  <script src="https://ethereum.github.io/rig/static/react.development.js"></script>
  <script src="https://ethereum.github.io/rig/static/react-dom.development.js"></script>
  <script src="https://ethereum.github.io/rig/static/component-library.js"></script>
  <script src="https://ethereum.github.io/rig/static/header.js"></script>
  <script src="https://ethereum.github.io/rig/static/footer.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>





<style type="text/css">
    pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight .hll { background-color: var(--jp-cell-editor-active-background) }
.highlight { background: var(--jp-cell-editor-background); color: var(--jp-mirror-editor-variable-color) }
.highlight .c { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment */
.highlight .err { color: var(--jp-mirror-editor-error-color) } /* Error */
.highlight .k { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword */
.highlight .o { color: var(--jp-mirror-editor-operator-color); font-weight: bold } /* Operator */
.highlight .p { color: var(--jp-mirror-editor-punctuation-color) } /* Punctuation */
.highlight .ch { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Hashbang */
.highlight .cm { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Multiline */
.highlight .cp { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Preproc */
.highlight .cpf { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.PreprocFile */
.highlight .c1 { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Single */
.highlight .cs { color: var(--jp-mirror-editor-comment-color); font-style: italic } /* Comment.Special */
.highlight .kc { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: var(--jp-mirror-editor-keyword-color); font-weight: bold } /* Keyword.Type */
.highlight .m { color: var(--jp-mirror-editor-number-color) } /* Literal.Number */
.highlight .s { color: var(--jp-mirror-editor-string-color) } /* Literal.String */
.highlight .ow { color: var(--jp-mirror-editor-operator-color); font-weight: bold } /* Operator.Word */
.highlight .w { color: var(--jp-mirror-editor-variable-color) } /* Text.Whitespace */
.highlight .mb { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Bin */
.highlight .mf { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Float */
.highlight .mh { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Hex */
.highlight .mi { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Integer */
.highlight .mo { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Oct */
.highlight .sa { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Affix */
.highlight .sb { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Backtick */
.highlight .sc { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Char */
.highlight .dl { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Delimiter */
.highlight .sd { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Doc */
.highlight .s2 { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Double */
.highlight .se { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Escape */
.highlight .sh { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Heredoc */
.highlight .si { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Interpol */
.highlight .sx { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Other */
.highlight .sr { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Regex */
.highlight .s1 { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Single */
.highlight .ss { color: var(--jp-mirror-editor-string-color) } /* Literal.String.Symbol */
.highlight .il { color: var(--jp-mirror-editor-number-color) } /* Literal.Number.Integer.Long */
  </style>



<link rel="stylesheet" type="text/css" href="https://ethereum.github.io/rig/static/jupyter.css"/>
<link rel="stylesheet" type="text/css" href="https://ethereum.github.io/rig/static/theme-light.css"/>
<style type="text/css">
a.anchor-link {
   display: none;
}
.highlight  {
    margin: 0.4em;
}

/* Input area styling */
.jp-InputArea {
    overflow: hidden;
}

.jp-InputArea-editor {
    overflow: hidden;
}

@media print {
  body {
    margin: 0;
  }
}
</style>


<!-- Load mathjax -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-MML-AM_CHTML-full,Safe"> </script>
    <!-- MathJax configuration -->
    <script type="text/x-mathjax-config">
    init_mathjax = function() {
        if (window.MathJax) {
        // MathJax loaded
            MathJax.Hub.Config({
                TeX: {
                    equationNumbers: {
                    autoNumber: "AMS",
                    useLabelIds: true
                    }
                },
                tex2jax: {
                    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                    displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
                    processEscapes: true,
                    processEnvironments: true
                },
                displayAlign: 'center',
                CommonHTML: {
                    linebreaks: { 
                    automatic: true 
                    }
                },
                "HTML-CSS": {
                    linebreaks: { 
                    automatic: true 
                    }
                }
            });
        
            MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
        }
    }
    init_mathjax();
    </script>
    <!-- End of mathjax configuration -->
  <link rel="stylesheet" type="text/css" href="https://ethereum.github.io/rig/static/index.css"/>
</head>
<body class="jp-Notebook" data-jp-theme-light="true" data-jp-theme-name="JupyterLab Light">

  <div id="header"></div>
  <script>
    ReactDOM.render(
      e(Header, null),
      document.querySelector("#header")
    );
    const hamburger = document.querySelector(".hamburger");
    const navMenu = document.querySelector(".nav-menu");

    function mobileMenu() {
        hamburger.classList.toggle("active");
        navMenu.classList.toggle("active");
    }

    function closeMenu() {
        hamburger.classList.remove("active");
        navMenu.classList.remove("active");
    }

    hamburger.addEventListener("click", mobileMenu);

    const navLink = document.querySelectorAll(".nav-link");

    navLink.forEach(n => n.addEventListener("click", closeMenu));
  </script>
  <div class="article-container">
    <div class="document-container">
      <div class="title-container">
        <div class="title">
          Simulating validator rewards in Altair
        </div>

        <div class="sub-title">
          
        </div>
      </div>

      <div id="toc-author-block">
        <div id="authors"></div>
        <div id="toc"></div>
      </div>
      
<div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h2 id="How-to-use">How to use<a class="anchor-link" href="#How-to-use">&#182;</a></h2><p>In this noteboook we test the rewards given out by the protocol to different types of validators. Our <code>fast</code> config reduces the size of most constants to avoid allocating more memory than necessary (we'll only test with a few validators). We also reduce the number of slots per epoch to speed things up. All these changes are without loss of generality.</p>
<p>You may test various spec versions by renaming either of the <code>specs_*.py</code> files in the <code>beaconrunner</code> folder to <code>specs.py</code>. Current version tested is v1.1.0-alpha.5-PR2453.</p>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<details><summary>Input 1 (click to open)</summary>
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[1]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">importlib</span>
<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">from</span> <span class="nn">eth2spec.config.config_util</span> <span class="kn">import</span> <span class="n">prepare_config</span>
<span class="kn">from</span> <span class="nn">eth2spec.utils.ssz.ssz_impl</span> <span class="kn">import</span> <span class="n">hash_tree_root</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="c1"># Load current beacon runner specs (v1.1.0-alpha.3)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">pardir</span><span class="p">))</span>

<span class="kn">import</span> <span class="nn">beaconrunner</span> <span class="k">as</span> <span class="nn">br</span>

<span class="n">prepare_config</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;fast.yaml&quot;</span><span class="p">)</span>

<span class="n">br</span><span class="o">.</span><span class="n">reload_package</span><span class="p">(</span><span class="n">br</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</details>

</div>
<div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Below are metrics extracted from the state of the simulation. We don't really care about most of them except for <code>get_current_validator_state</code>, but they are left here for future use/reference.</p>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<details><summary>Input 2 (click to open)</summary>
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[2]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">extract_state</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">validators</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s2">&quot;network&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">validators</span>
    <span class="n">validator</span> <span class="o">=</span> <span class="n">validators</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">head</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="n">specs</span><span class="o">.</span><span class="n">get_head</span><span class="p">(</span><span class="n">validator</span><span class="o">.</span><span class="n">store</span><span class="p">)</span>
    <span class="n">current_state</span> <span class="o">=</span> <span class="n">validator</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">block_states</span><span class="p">[</span><span class="n">head</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">current_state</span>

<span class="k">def</span> <span class="nf">current_slot</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">sL</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">_input</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;current_slot&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="s2">&quot;network&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">validators</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">slot</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">total_balance_asap</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">sL</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">_input</span><span class="p">):</span>
    <span class="n">validators</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s2">&quot;network&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">validators</span>
    <span class="n">current_state</span> <span class="o">=</span> <span class="n">extract_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">current_epoch</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="n">specs</span><span class="o">.</span><span class="n">get_current_epoch</span><span class="p">(</span><span class="n">current_state</span><span class="p">)</span>
    <span class="n">asap_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">validators</span><span class="p">)</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">validator_behaviour</span> <span class="o">==</span> <span class="s2">&quot;asap&quot;</span><span class="p">]</span>
    <span class="n">asap_balances</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">current_state</span><span class="o">.</span><span class="n">balances</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">asap_indices</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;total_balance_asap&quot;</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">asap_balances</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">get_base_reward</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">sL</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">_input</span><span class="p">):</span>
    <span class="n">current_state</span> <span class="o">=</span> <span class="n">extract_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">base_reward</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="n">specs</span><span class="o">.</span><span class="n">get_base_reward</span><span class="p">(</span><span class="n">current_state</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;base_reward&quot;</span><span class="p">,</span> <span class="n">base_reward</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_block_proposer</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">sL</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">_input</span><span class="p">):</span>
    <span class="n">current_state</span> <span class="o">=</span> <span class="n">extract_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">block_proposer</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">validator_index</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">s</span><span class="p">[</span><span class="s2">&quot;network&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">validators</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">current_proposer_duties</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="s2">&quot;current_slot&quot;</span><span class="p">]</span> <span class="o">%</span> <span class="n">br</span><span class="o">.</span><span class="n">specs</span><span class="o">.</span><span class="n">SLOTS_PER_EPOCH</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;block_proposer&quot;</span><span class="p">,</span> <span class="n">block_proposer</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_block_proposer_balance</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">sL</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">_input</span><span class="p">):</span>
    <span class="n">current_state</span> <span class="o">=</span> <span class="n">extract_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">block_proposer_balance</span> <span class="o">=</span> <span class="n">current_state</span><span class="o">.</span><span class="n">balances</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="s2">&quot;block_proposer&quot;</span><span class="p">]]</span>
    <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;block_proposer_balance&quot;</span><span class="p">,</span> <span class="n">block_proposer_balance</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_sync_committee</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">sL</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">_input</span><span class="p">):</span>
    <span class="n">current_state</span> <span class="o">=</span> <span class="n">extract_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">current_epoch</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="n">specs</span><span class="o">.</span><span class="n">get_current_epoch</span><span class="p">(</span><span class="n">current_state</span><span class="p">)</span>
    <span class="n">sync_committee</span> <span class="o">=</span> <span class="n">current_state</span><span class="o">.</span><span class="n">current_sync_committee</span>
    <span class="n">sync_committee</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="n">specs</span><span class="o">.</span><span class="n">get_sync_committee_indices</span><span class="p">(</span><span class="n">current_state</span><span class="p">,</span> <span class="n">current_epoch</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;sync_committee&quot;</span><span class="p">,</span> <span class="n">sync_committee</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_head</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">sL</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">_input</span><span class="p">):</span>
    <span class="n">validators</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s2">&quot;network&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">validators</span>
    <span class="n">validator</span> <span class="o">=</span> <span class="n">validators</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">head</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="n">specs</span><span class="o">.</span><span class="n">get_head</span><span class="p">(</span><span class="n">validator</span><span class="o">.</span><span class="n">store</span><span class="p">)</span><span class="o">.</span><span class="n">hex</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;head&quot;</span><span class="p">,</span> <span class="n">head</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_current_validator_state</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">sL</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">_input</span><span class="p">):</span>
    <span class="n">current_state</span> <span class="o">=</span> <span class="n">extract_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">current_validator_state</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">s</span><span class="p">[</span><span class="s2">&quot;network&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">validators</span><span class="p">:</span>
        <span class="n">current_validator_state</span> <span class="o">+=</span> <span class="p">[{</span>
            <span class="s2">&quot;slot&quot;</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">slot</span><span class="p">,</span>
            <span class="s2">&quot;validator_index&quot;</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">validator_index</span><span class="p">,</span>
            <span class="s2">&quot;balance&quot;</span><span class="p">:</span> <span class="n">current_state</span><span class="o">.</span><span class="n">balances</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">validator_index</span><span class="p">],</span>
            <span class="s2">&quot;block_proposer&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="s2">&quot;block_proposer&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="o">.</span><span class="n">validator_index</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;attester&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">current_attest_slot</span> <span class="o">==</span> <span class="n">v</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">slot</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;sync_committee&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">current_sync_committee</span><span class="p">),</span>
        <span class="p">}]</span>
    <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;current_validator_state&quot;</span><span class="p">,</span> <span class="n">current_validator_state</span><span class="p">)</span>

<span class="n">observers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;current_slot&quot;</span><span class="p">:</span> <span class="n">current_slot</span><span class="p">,</span>
    <span class="s2">&quot;total_balance_asap&quot;</span><span class="p">:</span> <span class="n">total_balance_asap</span><span class="p">,</span>
    <span class="s2">&quot;base_reward&quot;</span><span class="p">:</span> <span class="n">get_base_reward</span><span class="p">,</span>
    <span class="s2">&quot;block_proposer&quot;</span><span class="p">:</span> <span class="n">get_block_proposer</span><span class="p">,</span>
    <span class="s2">&quot;block_proposer_balance&quot;</span><span class="p">:</span> <span class="n">get_block_proposer_balance</span><span class="p">,</span>
<span class="c1">#     &quot;sync_committee&quot;: get_sync_committee,</span>
    <span class="s2">&quot;head&quot;</span><span class="p">:</span> <span class="n">get_head</span><span class="p">,</span>
    <span class="s2">&quot;current_validator_state&quot;</span><span class="p">:</span> <span class="n">get_current_validator_state</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>

     </div>
</div>
</div>
</div>

</details>

</div>
<div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Run the simulation.</p>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<details><summary>Input 3 (click to open)</summary>
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[3]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">sample</span>
<span class="kn">from</span> <span class="nn">beaconrunner.validators.ASAPValidator</span> <span class="kn">import</span> <span class="n">ASAPValidator</span>

<span class="n">num_validators</span> <span class="o">=</span> <span class="mi">16</span>

<span class="c1"># Initiate validators</span>
<span class="n">validators</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_validators</span><span class="p">):</span>
    <span class="n">new_validator</span> <span class="o">=</span> <span class="n">ASAPValidator</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">validators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_validator</span><span class="p">)</span>

<span class="c1"># Create a genesis state</span>
<span class="p">(</span><span class="n">genesis_state</span><span class="p">,</span> <span class="n">genesis_block</span><span class="p">)</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="n">simulator</span><span class="o">.</span><span class="n">get_genesis_state_block</span><span class="p">(</span><span class="n">validators</span><span class="p">)</span>

<span class="c1"># Validators load the state</span>
<span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">load_state</span><span class="p">(</span><span class="n">genesis_state</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">genesis_block</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">validators</span><span class="p">]</span>

<span class="c1"># We skip the genesis block</span>
<span class="n">br</span><span class="o">.</span><span class="n">simulator</span><span class="o">.</span><span class="n">skip_genesis_block</span><span class="p">(</span><span class="n">validators</span><span class="p">)</span>

<span class="c1"># Create the network</span>
<span class="n">set_a</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">NetworkSet</span><span class="p">(</span><span class="n">validators</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_validators</span><span class="p">)))</span>
<span class="n">network_sets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">([</span><span class="n">set_a</span><span class="p">])</span>
<span class="n">network</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">Network</span><span class="p">(</span><span class="n">validators</span> <span class="o">=</span> <span class="n">validators</span><span class="p">,</span> <span class="n">sets</span> <span class="o">=</span> <span class="n">network_sets</span><span class="p">)</span>

<span class="c1"># Set simulation parameters</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="n">simulator</span><span class="o">.</span><span class="n">SimulationParameters</span><span class="p">({</span>
    <span class="s2">&quot;num_epochs&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s2">&quot;run_index&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;frequency&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;network_update_rate&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
<span class="p">})</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="n">simulator</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">observers</span><span class="p">)</span> 
</pre></div>

     </div>
</div>
</div>
</div>

</details>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
<pre>will simulate 4 epochs ( 16 slots ) at frequency 1 moves/second
total 192 simulation steps

                  ___________    ____
  ________ __ ___/ / ____/   |  / __ \
 / ___/ __` / __  / /   / /| | / / / /
/ /__/ /_/ / /_/ / /___/ ___ |/ /_/ /
\___/\__,_/\__,_/\____/_/  |_/_____/
by cadCAD

Execution Mode: local_proc
Configuration Count: 1
Dimensions of the first simulation: (Timesteps, Params, Runs, Vars) = (192, 2, 1, 8)
</pre>
</div>
</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>







<div id="df33156a-6f53-4abf-95f6-b79c39beb608" class="jupyter-widgets jp-OutputArea-output ">
<script type="text/javascript">
var element = document.getElementById('df33156a-6f53-4abf-95f6-b79c39beb608');
</script>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "71b79bedc8164a18baca505589cd5c0e", "version_major": 2, "version_minor": 0}
</script>
</div>

</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
<pre>Execution Method: local_simulations
SimIDs   : [0]
SubsetIDs: [0]
Ns       : [0]
ExpIDs   : [0]
Execution Mode: single_threaded
11 proposing block for slot 1
11 proposing block for slot 2
6 proposing block for slot 3
5 proposing block for slot 4
9 proposing block for slot 5
0 proposing block for slot 6
0 proposing block for slot 7
12 proposing block for slot 8
7 proposing block for slot 9
timestep 100 of run 1
13 proposing block for slot 10
10 proposing block for slot 11
2 proposing block for slot 12
0 proposing block for slot 13
4 proposing block for slot 14
9 proposing block for slot 15
4 proposing block for slot 16
</pre>
</div>
</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>







<div id="10b55a1a-f845-4207-ada1-32fee381e5c0" class="jupyter-widgets jp-OutputArea-output ">
<script type="text/javascript">
var element = document.getElementById('10b55a1a-f845-4207-ada1-32fee381e5c0');
</script>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "b66178347d49482c8bc7503907ce4103", "version_major": 2, "version_minor": 0}
</script>
</div>

</div>

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
<pre>Total execution time: 90.05s
</pre>
</div>
</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs  ">
<details><summary>Input 4 (click to open)</summary>
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[4]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;network&#39;</span><span class="p">,</span> <span class="s1">&#39;simulation&#39;</span><span class="p">,</span> <span class="s1">&#39;subset&#39;</span><span class="p">,</span> <span class="s1">&#39;run&#39;</span><span class="p">])</span>
</pre></div>

     </div>
</div>
</div>
</div>

</details>

</div>
<div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>We collect the validator state data in a separate dataframe, of schema <code>(slot, validator_index, balance, block_proposer, attester, sync_committee)</code>. We ignore the first few epochs (rewards aren't given out, or imperfectly) and make sure the key <code>(slot, validator_index)</code> is unique.</p>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<details><summary>Input 5 (click to open)</summary>
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[5]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_rows&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">validator_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">df</span><span class="p">[((</span><span class="n">df</span><span class="o">.</span><span class="n">substep</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">substep</span> <span class="o">==</span> <span class="mi">4</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">timestep</span> <span class="o">%</span> <span class="mi">12</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">current_slot</span> <span class="o">&gt;</span> <span class="mi">11</span><span class="p">)][</span><span class="s2">&quot;current_validator_state&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:])</span>
<span class="p">)</span>
<span class="n">validator_df</span><span class="p">[</span><span class="s2">&quot;previous_balance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">validator_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;validator_index&quot;</span><span class="p">])[[</span><span class="s2">&quot;balance&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">shift</span><span class="p">()</span>
<span class="n">validator_df</span><span class="p">[</span><span class="s2">&quot;balance_diff&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">validator_df</span><span class="p">[</span><span class="s2">&quot;balance&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">validator_df</span><span class="p">[</span><span class="s2">&quot;previous_balance&quot;</span><span class="p">]</span>
<span class="n">validator_df</span> <span class="o">=</span> <span class="n">validator_df</span><span class="p">[</span><span class="n">validator_df</span><span class="o">.</span><span class="n">slot</span> <span class="o">&gt;</span> <span class="mi">12</span><span class="p">]</span>
<span class="n">validator_df</span>
</pre></div>

     </div>
</div>
</div>
</div>

</details>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt">Out[5]:</div>



<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output jp-OutputArea-executeResult" data-mime-type="text/html">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>slot</th>
      <th>validator_index</th>
      <th>balance</th>
      <th>block_proposer</th>
      <th>attester</th>
      <th>sync_committee</th>
      <th>previous_balance</th>
      <th>balance_diff</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>16</th>
      <td>13</td>
      <td>0</td>
      <td>32009011262</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>3.200754e+10</td>
      <td>1475787.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>13</td>
      <td>1</td>
      <td>32000626094</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>3.200063e+10</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>13</td>
      <td>2</td>
      <td>32005657199</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>3.200566e+10</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19</th>
      <td>13</td>
      <td>3</td>
      <td>32004718064</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>3.200467e+10</td>
      <td>44721.0</td>
    </tr>
    <tr>
      <th>20</th>
      <td>13</td>
      <td>4</td>
      <td>32000626094</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3.200063e+10</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>21</th>
      <td>13</td>
      <td>5</td>
      <td>32005657199</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>3.200566e+10</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>22</th>
      <td>13</td>
      <td>6</td>
      <td>32002057160</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3.200206e+10</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>23</th>
      <td>13</td>
      <td>7</td>
      <td>32006149130</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>3.200610e+10</td>
      <td>44721.0</td>
    </tr>
    <tr>
      <th>24</th>
      <td>13</td>
      <td>8</td>
      <td>32001118025</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>3.200107e+10</td>
      <td>44721.0</td>
    </tr>
    <tr>
      <th>25</th>
      <td>13</td>
      <td>9</td>
      <td>32006149130</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>3.200610e+10</td>
      <td>44721.0</td>
    </tr>
    <tr>
      <th>26</th>
      <td>13</td>
      <td>10</td>
      <td>32005657199</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3.200566e+10</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>27</th>
      <td>13</td>
      <td>11</td>
      <td>32006149130</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>3.200610e+10</td>
      <td>44721.0</td>
    </tr>
    <tr>
      <th>28</th>
      <td>13</td>
      <td>12</td>
      <td>32006149130</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>3.200610e+10</td>
      <td>44721.0</td>
    </tr>
    <tr>
      <th>29</th>
      <td>13</td>
      <td>13</td>
      <td>32006149130</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>3.200610e+10</td>
      <td>44721.0</td>
    </tr>
    <tr>
      <th>30</th>
      <td>13</td>
      <td>14</td>
      <td>32004226133</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3.200423e+10</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>31</th>
      <td>13</td>
      <td>15</td>
      <td>32004226133</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3.200423e+10</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>32</th>
      <td>14</td>
      <td>0</td>
      <td>32009055983</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>3.200901e+10</td>
      <td>44721.0</td>
    </tr>
    <tr>
      <th>33</th>
      <td>14</td>
      <td>1</td>
      <td>32000626094</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3.200063e+10</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>34</th>
      <td>14</td>
      <td>2</td>
      <td>32005657199</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3.200566e+10</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>35</th>
      <td>14</td>
      <td>3</td>
      <td>32004762785</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>3.200472e+10</td>
      <td>44721.0</td>
    </tr>
    <tr>
      <th>36</th>
      <td>14</td>
      <td>4</td>
      <td>32002057160</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>3.200063e+10</td>
      <td>1431066.0</td>
    </tr>
    <tr>
      <th>37</th>
      <td>14</td>
      <td>5</td>
      <td>32005657199</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3.200566e+10</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>38</th>
      <td>14</td>
      <td>6</td>
      <td>32002057160</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>3.200206e+10</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>39</th>
      <td>14</td>
      <td>7</td>
      <td>32006193851</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>3.200615e+10</td>
      <td>44721.0</td>
    </tr>
    <tr>
      <th>40</th>
      <td>14</td>
      <td>8</td>
      <td>32001162746</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>3.200112e+10</td>
      <td>44721.0</td>
    </tr>
    <tr>
      <th>41</th>
      <td>14</td>
      <td>9</td>
      <td>32006193851</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>3.200615e+10</td>
      <td>44721.0</td>
    </tr>
    <tr>
      <th>42</th>
      <td>14</td>
      <td>10</td>
      <td>32005657199</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>3.200566e+10</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>43</th>
      <td>14</td>
      <td>11</td>
      <td>32006193851</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>3.200615e+10</td>
      <td>44721.0</td>
    </tr>
    <tr>
      <th>44</th>
      <td>14</td>
      <td>12</td>
      <td>32006193851</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>3.200615e+10</td>
      <td>44721.0</td>
    </tr>
    <tr>
      <th>45</th>
      <td>14</td>
      <td>13</td>
      <td>32006193851</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>3.200615e+10</td>
      <td>44721.0</td>
    </tr>
    <tr>
      <th>46</th>
      <td>14</td>
      <td>14</td>
      <td>32004226133</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3.200423e+10</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>47</th>
      <td>14</td>
      <td>15</td>
      <td>32004226133</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3.200423e+10</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>48</th>
      <td>15</td>
      <td>0</td>
      <td>32009100704</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>3.200906e+10</td>
      <td>44721.0</td>
    </tr>
    <tr>
      <th>49</th>
      <td>15</td>
      <td>1</td>
      <td>32000626094</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3.200063e+10</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>50</th>
      <td>15</td>
      <td>2</td>
      <td>32005657199</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3.200566e+10</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>51</th>
      <td>15</td>
      <td>3</td>
      <td>32004807506</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>3.200476e+10</td>
      <td>44721.0</td>
    </tr>
    <tr>
      <th>52</th>
      <td>15</td>
      <td>4</td>
      <td>32002057160</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3.200206e+10</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>53</th>
      <td>15</td>
      <td>5</td>
      <td>32005657199</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3.200566e+10</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>54</th>
      <td>15</td>
      <td>6</td>
      <td>32002057160</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3.200206e+10</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>55</th>
      <td>15</td>
      <td>7</td>
      <td>32006238572</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>3.200619e+10</td>
      <td>44721.0</td>
    </tr>
    <tr>
      <th>56</th>
      <td>15</td>
      <td>8</td>
      <td>32001207467</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>3.200116e+10</td>
      <td>44721.0</td>
    </tr>
    <tr>
      <th>57</th>
      <td>15</td>
      <td>9</td>
      <td>32007669638</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>3.200619e+10</td>
      <td>1475787.0</td>
    </tr>
    <tr>
      <th>58</th>
      <td>15</td>
      <td>10</td>
      <td>32005657199</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3.200566e+10</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>59</th>
      <td>15</td>
      <td>11</td>
      <td>32006238572</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>3.200619e+10</td>
      <td>44721.0</td>
    </tr>
    <tr>
      <th>60</th>
      <td>15</td>
      <td>12</td>
      <td>32006238572</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>3.200619e+10</td>
      <td>44721.0</td>
    </tr>
    <tr>
      <th>61</th>
      <td>15</td>
      <td>13</td>
      <td>32006238572</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>3.200619e+10</td>
      <td>44721.0</td>
    </tr>
    <tr>
      <th>62</th>
      <td>15</td>
      <td>14</td>
      <td>32004226133</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>3.200423e+10</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>63</th>
      <td>15</td>
      <td>15</td>
      <td>32004226133</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3.200423e+10</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>64</th>
      <td>16</td>
      <td>0</td>
      <td>32011560359</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>3.200910e+10</td>
      <td>2459655.0</td>
    </tr>
    <tr>
      <th>65</th>
      <td>16</td>
      <td>1</td>
      <td>32003041028</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3.200063e+10</td>
      <td>2414934.0</td>
    </tr>
    <tr>
      <th>66</th>
      <td>16</td>
      <td>2</td>
      <td>32008072133</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3.200566e+10</td>
      <td>2414934.0</td>
    </tr>
    <tr>
      <th>67</th>
      <td>16</td>
      <td>3</td>
      <td>32007267161</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>3.200481e+10</td>
      <td>2459655.0</td>
    </tr>
    <tr>
      <th>68</th>
      <td>16</td>
      <td>4</td>
      <td>32005903160</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>3.200206e+10</td>
      <td>3846000.0</td>
    </tr>
    <tr>
      <th>69</th>
      <td>16</td>
      <td>5</td>
      <td>32008072133</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3.200566e+10</td>
      <td>2414934.0</td>
    </tr>
    <tr>
      <th>70</th>
      <td>16</td>
      <td>6</td>
      <td>32004472094</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3.200206e+10</td>
      <td>2414934.0</td>
    </tr>
    <tr>
      <th>71</th>
      <td>16</td>
      <td>7</td>
      <td>32008698227</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>3.200624e+10</td>
      <td>2459655.0</td>
    </tr>
    <tr>
      <th>72</th>
      <td>16</td>
      <td>8</td>
      <td>32003667122</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>3.200121e+10</td>
      <td>2459655.0</td>
    </tr>
    <tr>
      <th>73</th>
      <td>16</td>
      <td>9</td>
      <td>32010129293</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>3.200767e+10</td>
      <td>2459655.0</td>
    </tr>
    <tr>
      <th>74</th>
      <td>16</td>
      <td>10</td>
      <td>32008072133</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>3.200566e+10</td>
      <td>2414934.0</td>
    </tr>
    <tr>
      <th>75</th>
      <td>16</td>
      <td>11</td>
      <td>32008698227</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>3.200624e+10</td>
      <td>2459655.0</td>
    </tr>
    <tr>
      <th>76</th>
      <td>16</td>
      <td>12</td>
      <td>32008698227</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>3.200624e+10</td>
      <td>2459655.0</td>
    </tr>
    <tr>
      <th>77</th>
      <td>16</td>
      <td>13</td>
      <td>32008698227</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>3.200624e+10</td>
      <td>2459655.0</td>
    </tr>
    <tr>
      <th>78</th>
      <td>16</td>
      <td>14</td>
      <td>32006641067</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>3.200423e+10</td>
      <td>2414934.0</td>
    </tr>
    <tr>
      <th>79</th>
      <td>16</td>
      <td>15</td>
      <td>32006641067</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3.200423e+10</td>
      <td>2414934.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>

</div>

</div>
<div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h2 id="Obtaining-rewards-per-duty">Obtaining rewards per duty<a class="anchor-link" href="#Obtaining-rewards-per-duty">&#182;</a></h2><p>We isolate validators who occupied a unique role over a slot to obtain the rewards for block proposers and sync committee members. When rewards are given out during the epoch transition, the minimum received by any validator is received by a validator who neither proposed a block for the whole epoch and was never part of the sync committee, giving us the attester reward received by one validator.</p>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<details><summary>Input 6 (click to open)</summary>
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[6]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">block_proposer_reward</span> <span class="o">=</span> <span class="n">validator_df</span><span class="p">[(</span><span class="n">validator_df</span><span class="o">.</span><span class="n">block_proposer</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">validator_df</span><span class="o">.</span><span class="n">sync_committee</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;balance_diff&quot;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;block proposer reward = </span><span class="si">{</span><span class="n">block_proposer_reward</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</details>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
<pre>block proposer reward = 1431066.0
</pre>
</div>
</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<details><summary>Input 7 (click to open)</summary>
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[7]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">attester_reward</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">validator_df</span><span class="p">[</span><span class="n">validator_df</span><span class="o">.</span><span class="n">slot</span> <span class="o">%</span> <span class="n">br</span><span class="o">.</span><span class="n">specs</span><span class="o">.</span><span class="n">SLOTS_PER_EPOCH</span> <span class="o">==</span> <span class="mi">0</span><span class="p">][</span><span class="s2">&quot;balance_diff&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;attester reward = </span><span class="si">{</span><span class="n">attester_reward</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</details>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
<pre>attester reward = 2414934.0
</pre>
</div>
</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<details><summary>Input 8 (click to open)</summary>
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[8]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sync_committee_reward</span> <span class="o">=</span> <span class="n">validator_df</span><span class="p">[(</span><span class="n">validator_df</span><span class="o">.</span><span class="n">block_proposer</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">validator_df</span><span class="o">.</span><span class="n">sync_committee</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;balance_diff&quot;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sync committee reward = </span><span class="si">{</span><span class="n">sync_committee_reward</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</details>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
<pre>sync committee reward = 44721.0
</pre>
</div>
</div>

</div>

</div>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<details><summary>Input 9 (click to open)</summary>
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[9]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">base_reward</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;base_reward&quot;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;base reward = </span><span class="si">{</span><span class="n">base_reward</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</details>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
<pre>base reward = 2862144
</pre>
</div>
</div>

</div>

</div>

</div>
<div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Make our checks.</p>

</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell   ">
<details><summary>Input 10 (click to open)</summary>
<div class="jp-Cell-inputWrapper">
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&nbsp;[10]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
     <div class="CodeMirror cm-s-jupyter">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">total_per_epoch</span> <span class="o">=</span> <span class="n">num_validators</span> <span class="o">*</span> <span class="n">base_reward</span>
<span class="n">total_for_proposers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">br</span><span class="o">.</span><span class="n">specs</span><span class="o">.</span><span class="n">SLOTS_PER_EPOCH</span><span class="p">)</span> <span class="o">*</span> <span class="n">block_proposer_reward</span>
<span class="n">total_for_attesters</span> <span class="o">=</span> <span class="n">num_validators</span> <span class="o">*</span> <span class="n">attester_reward</span>
<span class="n">total_for_sync_committee</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">br</span><span class="o">.</span><span class="n">specs</span><span class="o">.</span><span class="n">SLOTS_PER_EPOCH</span><span class="p">)</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">br</span><span class="o">.</span><span class="n">specs</span><span class="o">.</span><span class="n">SYNC_COMMITTEE_SIZE</span><span class="p">)</span> <span class="o">*</span> <span class="n">sync_committee_reward</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;expected total per epoch = </span><span class="si">{</span><span class="n">total_per_epoch</span><span class="si">}</span><span class="s2"> vs. realised total = </span><span class="si">{</span><span class="n">total_for_proposers</span> <span class="o">+</span> <span class="n">total_for_attesters</span> <span class="o">+</span> <span class="n">total_for_sync_committee</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;percent of attester rewards = </span><span class="si">{</span><span class="n">total_for_attesters</span> <span class="o">/</span> <span class="n">total_per_epoch</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;percent of sync committee rewards = </span><span class="si">{</span><span class="n">total_for_sync_committee</span> <span class="o">/</span> <span class="n">total_per_epoch</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;percent of block proposer rewards = </span><span class="si">{</span><span class="n">total_for_proposers</span> <span class="o">/</span> <span class="n">total_per_epoch</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

     </div>
</div>
</div>
</div>

</details>

<div class="jp-Cell-outputWrapper">


<div class="jp-OutputArea jp-Cell-outputArea">

<div class="jp-OutputArea-child">

    
    <div class="jp-OutputPrompt jp-OutputArea-prompt"></div>


<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain">
<pre>expected total per epoch = 45794304 vs. realised total = 45794280.0
percent of attester rewards = 0.84375
percent of sync committee rewards = 0.03125
percent of block proposer rewards = 0.12499947591735426
</pre>
</div>
</div>

</div>

</div>

</div>




    </div>
  </div>
  <script>
  // References + footnotes

// Authors
let authorData = ["barnabe"];
  </script>

  
</body>

  <div id="footer"></div>
    <script>
    ReactDOM.render(
      e(
        Footer, {
          acknowledgements: '',
        }
      ),
      document.querySelector("#footer")
    )

    const copyToClipboard = str => {
      const el = document.createElement("textarea") // Create a <textarea> element
      el.value = str // Set its value to the string that you want copied
      el.setAttribute("readonly", "") // Make it readonly to be tamper-proof
      el.style.position = "absolute"
      el.style.left = "-9999px" // Move outside the screen to make it invisible
      document.body.appendChild(el) // Append the <textarea> element to the HTML document
      const selected =
        document.getSelection().rangeCount > 0 // Check if there is any content selected previously
          ? document.getSelection().getRangeAt(0) // Store selection if found
          : false // Mark as false to know no selection existed before
      el.select() // Select the <textarea> content
      document.execCommand("copy") // Copy - only works as a result of a user action (e.g. click events)
      document.body.removeChild(el) // Remove the <textarea> element
      if (selected) {
        // If a selection existed before copying
        document.getSelection().removeAllRanges() // Unselect everything on the HTML document
        document.getSelection().addRange(selected) // Restore the original selection
      }
    }
    function handleCopyClick(evt) {
      // get the children of the parent element
      const { children } = evt.target.parentElement
      // grab the first element (we append the copy button on afterwards, so the first will be the code element)
      // destructure the innerText from the code block
      const { innerText } = Array.from(children)[0]
      // copy all of the code to the clipboard
      copyToClipboard(innerText)
    }

    const highlights = document.querySelectorAll(".jp-InputArea-editor .highlight")

    highlights.forEach(div => {
      // create the copy button
      const copy = document.createElement("button")
      copy.innerHTML = "Copy"
      // add the event listener to each click
      copy.addEventListener("click", handleCopyClick)
      // append the copy button to each code block
      div.append(copy)
    })
    </script>
  </div>
  <script src="https://ethereum.github.io/rig/static/authorFormatting.js"></script>
  <script src="https://ethereum.github.io/rig/static/sectionFormatting.js"></script>
  <script src="https://ethereum.github.io/rig/static/referencesFormatting.js"></script>







</html>
